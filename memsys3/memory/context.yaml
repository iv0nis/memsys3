# Context - memsys3
# Compilado automáticamente por Context Agent
# Este es el contexto optimizado que los Development Agents leen al iniciar sesión

metadata:
  compilado_por: "Context Agent"
  ultima_compilacion: "2025-11-12"
  version_context: "1.7"

# ============================================
# README DEL PROYECTO
# ============================================
readme_proyecto: |
  # memsys3 - Sistema de Memoria para Agentes de IA

  Sistema replicable de gestión de contexto para optimizar el trabajo con AI Development Agents.

  **Problema que resuelve:**
  - Los agents deben leer decenas de archivos para entender el proyecto
  - Cada sesión consume miles de tokens repitiendo contexto
  - Decisiones y aprendizajes se pierden entre sesiones
  - No hay visibilidad de qué "sabe" el agent

  **Solución:**
  - Context compilado en único archivo (~2000-3000 tokens)
  - Sistema documentación estructurado (ADRs, sessions, status)
  - Context Agent filtra automáticamente información relevante
  - Visualizador web para ver la "mente" de agents
  - Prompts reutilizables (newSession, endSession, compile-context, mind, deploy)
  - Rotación automática >1800 líneas
  - Plan contingencia >150K tokens
  - Prompt actualizar.md para updates seguros
  - README opcional con creación automática

  **Quick Start:**

  Deployment inicial:
  ```bash
  @memsys3/prompts/deploy.md
  ```

  Primeros pasos:
  ```bash
  @memsys3/prompts/compile-context.md  # Compila contexto
  @memsys3/prompts/mind.md             # Visualiza memoria
  @memsys3/prompts/newSession.md       # Comienza trabajo
  ```

  **Workflow:**
  1. Documentar (ADRs, sessions, project-status)
  2. Compilar (Context Agent genera context.yaml compacto)
  3. Desarrollar (DevAI carga contexto completo)

  **Features principales:**
  - Context Agent con criterio inteligente (límite único 2000 líneas)
  - Rotación automática (sessions/adr >1800 líneas → sessions_N.yaml)
  - Plan Contingencia (>150K tokens → archiva irrelevantes a history/)
  - Templates YAML (~30% ahorro tokens vs Markdown)
  - Sistema actualización (actualizar.md con detección estructura antigua)
  - Visualizador web (4 pestañas: Agent View, Full History, Project Status, Stats)

  **Repositorio:** https://github.com/iv0nis/memsys3
  **Licencia:** MIT

# ============================================
# PROJECT INFO
# ============================================
project:
  nombre: "memsys3"
  descripcion: "Sistema de gestión de contexto para AI Development Agents"
  objetivo: "Optimizar consumo de tokens proporcionando contexto compacto y relevante"
  fase: "Development v1.6"
  ultima_feature: "Deployment tallersColomer exitoso + Mejora deploy.md con consulta .gitignore (PASO 8) + ADR-010"
  siguiente_milestone: "Commit mejoras + Testear deployment con consulta .gitignore en nuevo proyecto"
  client: "Open Source (GitHub: iv0nis/memsys3)"

# ============================================
# FEATURES OPERATIVAS
# ============================================
features:
  context_agent:
    nombre: "Context Agent"
    estado: "operativo"
    descripcion: "Agente que compila contexto completo con criterio inteligente (máx 2000 líneas)"

  rotacion_automatica:
    nombre: "Rotación Automática"
    estado: "operativo"
    descripcion: "Sistema de rotación sessions/ADRs cuando superan 1800 líneas"

  plan_contingencia:
    nombre: "Plan de Contingencia"
    estado: "operativo"
    descripcion: "Archivado inteligente a history/ cuando >150K tokens"

  visualizador:
    nombre: "Memory Visualizer"
    estado: "operativo"
    descripcion: "Dashboard web para ver la 'mente' de los agentes (4 pestañas)"

  prompts:
    nombre: "Prompts Reutilizables"
    estado: "operativo"
    descripcion: "newSession, endSession, compile-context, mind, deploy, actualizar, backlog - TODOS con rutas memsys3/"

  documentacion:
    nombre: "Sistema de Documentación Multi-nivel"
    estado: "operativo"
    descripcion: "4 niveles: README repo, README templates, DEVELOPMENT, UPDATE"

  sistema_actualizacion:
    nombre: "Prompt actualizar.md"
    estado: "operativo"
    descripcion: "Actualización segura memsys3 en proyectos existentes con detección estructura antigua (3 escenarios)"

  readme_opcional:
    nombre: "README Opcional en Context Agent"
    estado: "operativo"
    descripcion: "Context Agent acepta proyectos sin README o puede crear automáticamente desde project-status.yaml"

# ============================================
# STACK TECNOLÓGICO
# ============================================
stack:
  frontend: "HTML/CSS/JS (visualizador)"
  backend: "Python 3.x (servidor visualizador)"
  database: "Ninguno (YAML files)"
  deploy: "GitHub + clonado local"
  lenguaje_docs: "YAML + Markdown"

# ============================================
# URLS PRINCIPALES
# ============================================
urls:
  repository: "https://github.com/iv0nis/memsys3"

# ============================================
# ADRs RELEVANTES (10 totales, 7 incluidas)
# Seleccionadas por impacto arquitectónico global
# ============================================
adrs:
  - id: "001"
    titulo: "Criterio inteligente del Context Agent vs límites arbitrarios"
    decision: "Context Agent usa criterio inteligente basado en 'qué debe saber CUALQUIER agent descontextualizado'. Límite ÚNICO: máximo 2000 líneas context.yaml. NO límites arbitrarios para ADRs, sessions, gotchas."
    motivo: "Límites rígidos (máx 7 ADRs, máx 15 líneas sesión) no se adaptan a realidad del proyecto"
    impacto: "Contexto adaptativo según necesidades, proyectos pequeños mantienen todo, grandes filtran inteligentemente"

  - id: "002"
    titulo: "Rotación automática de sessions/ADRs (>1800 líneas)"
    decision: "Cuando sessions.yaml o adr.yaml superen 1800 líneas: endSession detecta automáticamente, hace rotación segura (copia → verifica → crea nuevo), genera sessions_N.yaml / adr_N.yaml. Context Agent lee TODOS los archivos rotados hasta detectar >150K tokens."
    motivo: "Read tool tiene límite 2000 líneas. Si archivos crecen demasiado, agents no pueden leerlos."
    impacto: "Sistema escala infinitamente sin perder datos nunca, automático sin intervención manual"

  - id: "003"
    titulo: "Plan de Contingencia con archivado inteligente (>150K tokens)"
    decision: "Cuando total de full/ supera 150K tokens: CA identifica ADRs/sessions irrelevantes con criterio, los mueve a memory/history/ (que NO se lee), reduce a ~120K tokens, continúa compilación normal. Datos en history/ preservados y recuperables."
    motivo: "Incluso con rotación, proyectos grandes pueden acumular demasiados datos y CA no puede procesarlos eficientemente."
    impacto: "Ahorro real de tokens (history/ NO se lee), datos preservados no perdidos, sistema escala ilimitadamente, reversible"

  - id: "006"
    titulo: "Sistema de rutas unificado memsys3/"
    decision: "TODAS las rutas en memsys3_templates/ usan prefijo memsys3/: memsys3/memory/context.yaml, memsys3/agents/main-agent.yaml, etc. Durante deployment, memsys3_templates/ se copia a raíz como memsys3/, todas rutas internas funcionan correctamente."
    motivo: "Confusión sobre rutas: memory/ vs @memory/, no claro si template o deployment, READMEs mezclaban niveles"
    impacto: "Claridad total (siempre se sabe que es de memsys3), portabilidad (funciona en cualquier proyecto), sin conflictos con carpetas del proyecto"

  - id: "008"
    titulo: "Main-Agent NO debe proponer compile-context"
    decision: "Main-Agent tiene restricción explícita: NO proponer ejecutar compile-context.md, solo sugerir endSession al finalizar. User decide cuándo compilar en nueva instancia limpia sin tokens acumulados."
    motivo: "Main-Agent trabaja durante sesiones acumulando tokens. compile-context requiere leer TODO memory/full/ (~50K+ tokens). Acumularía tokens sesión + tokens leer full/ + tokens generar context → ineficiente, puede superar límites."
    impacto: "Eficiencia tokens optimizada, Main-Agent enfocado en desarrollo, Context Agent trabaja con instancia limpia, user controla cuándo compilar"

  - id: "009"
    titulo: "Templates como documentación activa permanente + gotchas en sessions"
    decision: "memory/templates/ NO se borran después del deployment, son guías permanentes. Main-Agent consulta templates/ durante endSession ('¿Cómo estructuro sesión?' → sessions-template.yaml). Gotchas documentados en sessions.yaml donde surgen temporalmente. Context-Agent extrae de TODAS las sesiones, ordena por criticidad+recencia, selecciona top 5. project-status.yaml NO contiene gotchas."
    motivo: "Templates contienen estructura exacta, instrucciones uso, ejemplos buenas prácticas, especificaciones que endSession no detalla. Gotchas surgen DURANTE sesiones, deben estar contextualizados temporalmente."
    impacto: "Deployment simple (copiar todo), Main-Agent siempre tiene referencia, gotchas contextualizados, CA flexibilidad para priorizar, project-status limpio, ~15KB extra aceptable"

  - id: "010"
    titulo: "Consulta .gitignore durante deployment de memsys3"
    decision: "Agregar PASO 8 en deploy.md que pregunta al usuario si quiere excluir memsys3/ de GitHub ANTES de finalizar deployment. Opción A (RECOMENDADO): Excluir - para desarrollo individual. Opción B: Incluir - para equipos que quieran compartir contexto. Paso obligatorio (siempre pregunta), decisión del usuario."
    motivo: "Durante deployment tallersColomer detectado que memsys3/ no estaba excluido de git, subiría todo contexto local (sessions, ADRs, gotchas, información flujo trabajo) que debe ser privado."
    impacto: "Usuario consciente decisión privacidad, flexibilidad para equipos, deployment completo correcto desde inicio, no hay sorpresas después"

# ============================================
# SESIONES RECIENTES (24 totales, 2 incluidas)
# ============================================
sesiones_recientes:
  - id: "2025-11-12-deployment-tallerscolomer-mejora-gitignore"
    data: "2025-11-12"
    duracion: "~1.5h"
    titulo: "Deployment tallersColomer + Mejora deploy.md con consulta .gitignore"

    que_es_va_fer:
      - "Deployment exitoso memsys3 en tallersColomer (v0.6.1, proyecto Next.js+FastAPI+Supabase taller mecánico)"
      - "Mejora deploy.md: PASO 8 agregado consulta .gitignore (66 líneas nuevas, Opción A excluir recomendado, Opción B incluir)"
      - "ADR-010 creado documentando decisión sobre consulta .gitignore"
      - ".gitignore configurado en tallersColomer excluyendo memsys3/"

    problemas_resueltos:
      - "deploy.md no contemplaba configuración .gitignore, memsys3/ se subiría al repositorio → PASO 8 agregado con proceso automatizado"

    decisiones:
      - "Consulta obligatoria .gitignore durante deployment (no excluir automáticamente) - algunos equipos pueden querer compartir contexto"

    proximos_pasos:
      - "Testear deployment completo con nueva consulta .gitignore"
      - "Commit y push cambios (deploy.md + ADR-010)"

  - id: "2025-11-12-feature-002-actualizar-readme-opcional"
    data: "2025-11-12"
    duracion: "~4h"
    titulo: "FEATURE-002: actualizar.md + README opcional en Context Agent"

    que_es_va_fer:
      - "Prompt actualizar.md creado (551 líneas) para actualización segura memsys3"
      - "PASO 0 crítico: Detección estructura antigua incompatible (3 escenarios: solo /memory, /memory+/memsys3 coexistiendo, solo /memsys3)"
      - "Testing real deCastro_inmobiliaria: v1.0 → v0.5.0 con migración 676 líneas datos (134 sessions + 320 adr + 222 project-status)"
      - "README.md ahora opcional en Context Agent con condicional inteligente"
      - "compile-context.md pregunta si crear README automáticamente desde project-status.yaml"

    problemas_resueltos:
      - "actualizar.md no contemplaba estructura antigua incompatible pre-ADR-006 → PASO 0 detecta y previene pérdida datos"
      - "deCastro tenía DOS estructuras (datos reales en /memory antigua, datos template en /memsys3 nueva) → migración manual exitosa"
      - "README obligatorio rompería proyectos sin README → movido a opcional con condicional"

    decisiones:
      - "actualizar.md debe ser defensivo: detectar edge-cases antes de proceder"
      - "README opcional con pregunta crear automáticamente balances retrocompatibilidad y valor contexto"

    gotchas:
      - "Estructura pre-ADR-006 puede coexistir con estructura nueva sin migrar datos → detectar con ls -la memory/ && ls -la memsys3/"
      - "project-status.yaml puede tener datos template memsys3 en lugar del proyecto real → verificar que 'que_es' describe EL PROYECTO"

# ============================================
# GOTCHAS CRÍTICOS (5 más importantes)
# ============================================
gotchas:
  - id: "estructura_antigua_coexiste"
    problema: "Estructura pre-ADR-006 puede coexistir con estructura nueva sin migrar datos. Context Agent leería datos INCORRECTOS (template memsys3 en lugar del proyecto real)."
    solucion: "Detectar con: ls -la memory/ && ls -la memsys3/ → si ambos existen, verificar cuál tiene datos reales. actualizar.md PASO 0 detecta automáticamente."
    criticidad: "alta"

  - id: "project_status_con_datos_template"
    problema: "project-status.yaml puede tener datos del template memsys3 ('Sistema de gestió de context') en lugar del proyecto real tras deployment incorrecto"
    solucion: "Verificar que campos 'que_es' y 'objetivo' describen el PROYECTO, no memsys3"
    criticidad: "alta"

  - id: "deploy_sobrescribe_datos"
    problema: "deploy.md sin verificaciones puede sobrescribir memsys3/ existente al ejecutarse dos veces, causando pérdida datos irrecuperable (adr.yaml, sessions.yaml)"
    solucion: "Verificar si memsys3/ existe antes de mkdir. Limpiar memsys3_temp/ si existe. deploy.md ahora incluye estas verificaciones."
    criticidad: "alta"

  - id: "traducir_keys_no_es_valores"
    problema: "Traducir 'keys YAML' NO es lo mismo que traducir 'valores descriptivos YAML'. Son dos tareas diferentes y ambas necesarias."
    solucion: "Después de traducir keys (descripcio:→descripcion:), hacer verificación exhaustiva con grep de palabras catalanas en TODO el contenido, no solo keys"
    criticidad: "alta"

  - id: "history_vacio_no_sube_git"
    problema: "history/ vacío no se sube a git bloqueando Plan Contingencia en otros clones. Si CA intenta archivar, falla porque history/ no existe."
    solucion: "Crear .gitkeep en directorios vacíos que deben existir en git. deploy.md ahora crea history/.gitkeep"
    criticidad: "media"

# ============================================
# PENDIENTES PRIORITARIOS (5 top)
# ============================================
pendientes:
  - prioritat: 1
    tasca: "Commit y push mejoras deploy.md + ADR-010"
    detall: "Subir a GitHub: mejora consulta .gitignore en deploy.md (PASO 8) + ADR-010 documentando decisión"

  - prioritat: 2
    tasca: "Testear deployment con consulta .gitignore en nuevo proyecto"
    detall: "Validar que PASO 8 funciona correctamente y usuario puede elegir Opción A o B"

  - prioritat: 3
    tasca: "Testear actualizar.md en proyecto con estructura correcta (Escenario C)"
    detall: "Validar actualización en proyecto que solo tenga /memsys3 (no estructura antigua). Probar en Soluzzia"

  - prioritat: 4
    tasca: "Validar compile-context.md con creación automática de README"
    detall: "Ejecutar compile-context en deCastro (sin README), probar Opción A (crear automáticamente desde project-status.yaml)"

  - prioritat: 5
    tasca: "IMPROVEMENT-001 PARCIALMENTE RESUELTO - Evaluar siguiente fase"
    detall: "README ya incluido en contexto (opcional). Evaluar si agregar DEVELOPMENT.md, UPDATE.md según necesidad"

# ============================================
# NOTAS DE COMPILACIÓN
# ============================================
notas_compilacion:
  adrs_totales: 10
  adrs_incluidas: 7
  justificacion_adrs: "Incluidas ADRs con impacto arquitectónico global: criterio inteligente (001), rotación (002), plan contingencia (003), rutas unificadas (006), main-agent restricción (008), templates permanentes (009), consulta gitignore (010). Excluidas ADRs 004 (YAML format), 005 (deploy como prompt), 007 (separación READMEs) por ser menos críticas para agent descontextualizado."

  sesiones_totales: 24
  sesiones_incluidas: 2
  justificacion_sesiones: "Incluidas últimas 2 sesiones (deployment tallersColomer + FEATURE-002 actualizar.md) por ser más recientes y contener cambios significativos. Sesiones anteriores documentadas en ADRs o ya integradas en features operativas."

  gotchas_extraidos: 5
  criterios_gotchas: "Criticidad alta prioritaria, errores que rompen proyecto, contra-intuitivos, recientes. Extraídos de sesiones 2025-11-12 (deployment tallersColomer, FEATURE-002)."

  readme_incluido: true
  readme_lineas: 75
  readme_criterio: "Sintetizado manteniendo esencia: problema que resuelve, solución, quick start, workflow, features principales. Omitidos badges, licencias, detalles menores."

  tokens_iniciales_estimados: "~29K tokens"
  archivamiento: "NO requerido (< 150K tokens)"
  lineas_totales: "~650 líneas de 2000 máximo"

  observaciones: |
    Compilación normal exitosa, NO requerido Plan de Contingencia.

    Sistema en fase Development v1.6 con mejoras recientes:
    - Deployment tallersColomer exitoso (primer proyecto real con v0.6.1)
    - Mejora crítica deploy.md: consulta .gitignore (PASO 8) con ADR-010
    - Sistema actualización robusto (actualizar.md con detección estructura antigua)
    - README opcional con creación automática desde project-status

    Contexto compilado incluye 7 de 10 ADRs (70%) por ser arquitectónicamente críticas.
    Últimas 2 sesiones sintetizadas con highlights principales.
    5 gotchas críticos documentados para prevenir errores comunes.
    5 pendientes top prioritarios para siguiente trabajo.

    Sistema escalable y robusto para proyectos de cualquier tamaño.
