# Context Compilado - memsys3
# Compilado por Context Agent desde memory/full/

metadata:
  compilado_por: "Context Agent"
  ultima_compilacion: "2025-11-12"
  version_context: "1.6.1"

# ============================================
# README DEL PROYECTO
# ============================================
readme_proyecto: |
  # memsys3 - Sistema de Memoria para Agentes de IA

  Sistema replicable de gestión de contexto para optimizar el trabajo con AI Development Agents.

  ## Problema que Resuelve
  - Los agents deben leer decenas de archivos de código para entender el proyecto
  - Cada sesión nueva consume miles de tokens repitiendo el mismo contexto
  - Decisiones y aprendizajes se pierden entre sesiones
  - No hay visibilidad de qué "sabe" el agent

  ## Solución
  - Context compilado en un único archivo (~2500-3000 tokens)
  - Sistema de documentación estructurado (ADRs, sessions, status)
  - Context Agent que filtra automáticamente la información relevante
  - Visualizador web para ver la "mente" de los agents
  - Prompts reutilizables para comenzar/terminar sesiones
  - Sistema de rotación automática cuando supera límites (>1800 líneas)
  - Plan de contingencia con archivado inteligente (>150K tokens)

  ## Quick Start

  ### Deployment
  Desde la raíz de tu proyecto:
  ```bash
  @memsys3/prompts/deploy.md
  ```
  Workflow: Clone temporal → Copia estructura → Briefing → Personalización → Limpieza

  ### Primeros Pasos
  ```bash
  # Compila contexto inicial
  @memsys3/prompts/compile-context.md

  # Visualiza la "mente" de los agents
  @memsys3/prompts/mind.md

  # Comienza a trabajar
  @memsys3/prompts/newSession.md
  ```

  ## Estructura del Repositorio
  ```
  memsys3/
  ├── memsys3_templates/      # Producto final (templates agnósticos)
  │   ├── agents/            # main-agent, context-agent
  │   ├── memory/            # Templates YAML base
  │   ├── prompts/           # newSession, endSession, compile-context, etc.
  │   └── viz/               # Visualizador web
  └── memsys3/               # Dog-fooding (desarrollo, NO se distribuye)
  ```

  ## Workflow
  1. **Documentar**: Escribe decisiones (ADRs), sesiones, actualiza status
  2. **Compilar**: Context Agent genera context.yaml compacto con criterio inteligente
  3. **Desarrollar**: DevAI carga contexto completo, documenta al acabar

  ## Features Principales
  - Context Agent con criterio inteligente (máx 2000 líneas)
  - README opcional: acepta proyectos sin README o puede crear automáticamente
  - Rotación automática >1800 líneas
  - Plan de contingencia >150K tokens con archivado a history/
  - Sistema de templates YAML (~30% ahorro tokens vs Markdown)
  - Visualizador web con 4 pestañas
  - Sistema de Actualización: prompt actualizar.md con detección estructura antigua

  ## Requisitos
  - Python 3.x (visualizador)
  - AI agent compatible con prompts markdown
  - Git (opcional, para versionado)

# ============================================
# PROJECT INFO
# ============================================
project:
  nombre: "memsys3"
  descripcion: "Sistema de gestión de contexto para AI Development Agents"
  fase: "Development v1.5"
  ultima_feature: "FEATURE-002: actualizar.md + README opcional + Testing en deCastro"
  siguiente_milestone: "Testear actualizar.md en segundo proyecto + Validar compile-context con README automático"

# ============================================
# FEATURES OPERATIVAS
# ============================================
features:
  context_agent:
    nombre: "Context Agent"
    estado: "operativo"
    descripcion: "Compila contexto completo con criterio inteligente (máx 2000 líneas). Lee README.md (opcional), ADRs, sessions, project-status y filtra lo imprescindible"

  rotacion_automatica:
    nombre: "Rotación Automática"
    estado: "operativo"
    descripcion: "Detecta cuando sessions.yaml o adr.yaml superan 1800 líneas. Rotación segura: copia → verifica → crea nuevo. CA lee todos los archivos rotados"

  plan_contingencia:
    nombre: "Plan de Contingencia"
    estado: "operativo"
    descripcion: "Cuando contexto supera 150K tokens, CA archiva datos irrelevantes a history/ (no leído). Reduce a ~120K. Datos preservados, no perdidos"

  visualizador:
    nombre: "Memory Visualizer"
    estado: "operativo"
    descripcion: "Dashboard web en memsys3/viz/ con 4 pestañas: Agent View, Full History, Project Status, Stats. Servidor Python + js-yaml parser"

  prompts:
    nombre: "Prompts Reutilizables"
    estado: "operativo"
    descripcion: "5 prompts ejecutables: newSession, endSession, compile-context, mind, deploy. Todas las rutas usan prefijo memsys3/"

  sistema_actualizacion:
    nombre: "Prompt actualizar.md"
    estado: "operativo"
    descripcion: "Actualización segura de memsys3 en proyectos existentes. PASO 0 detecta estructura antigua incompatible (3 escenarios). Backups automáticos antes de tocar datos"

# ============================================
# STACK TECNOLÓGICO
# ============================================
stack:
  frontend: "HTML/CSS/JS (visualizador)"
  backend: "Python 3.x SimpleHTTPServer (visualizador)"
  database: "Ninguno (YAML files)"
  deploy: "GitHub + clonado local"
  lenguaje_docs: "YAML + Markdown"
  parser: "js-yaml 4.1.0 (CDN)"

# ============================================
# URLS PRINCIPALES
# ============================================
urls:
  repository: "https://github.com/iv0nis/memsys3"
  docs: "memsys3_templates/memory/README.md"

# ============================================
# ADRs RELEVANTES (Impacto Global)
# ============================================
adrs:
  - id: "001"
    titulo: "Criterio inteligente del Context Agent vs límites arbitrarios"
    decision: "CA usa criterio inteligente basándose en: '¿Qué debe saber CUALQUIER agent descontextualizado?' Límite ÚNICO: máx 2000 líneas. NO límites arbitrarios por ADRs/sessions"
    motivo: "Sistemas anteriores con límites rígidos (máx 7 ADRs, 15 líneas/sesión) no se adaptaban. Proyectos pequeños perdían contexto, grandes no podían expresarse"
    impacto: "Contexto adaptativo según necesidades del proyecto. CA decide con visión panorámica completa. Más flexible y escalable"

  - id: "002"
    titulo: "Rotación automática de sessions/ADRs (>1800 líneas)"
    decision: "Cuando sessions.yaml o adr.yaml superen 1800 líneas: endSession detecta automáticamente, rotación segura (copia → verifica → nuevo). CA lee TODOS los archivos rotados hasta >150K tokens"
    motivo: "Read tool tiene límite 2000 líneas. Si archivos crecen demasiado, agents no pueden leerlos"
    impacto: "Sistema escala infinitamente. No se pierden datos nunca. Automático, sin intervención manual. Preserva histórico completo"

  - id: "003"
    titulo: "Plan de Contingencia con archivado inteligente (>150K tokens)"
    decision: "Cuando total de full/ supera 150K tokens: CA identifica ADRs/sessions irrelevantes, mueve a history/ (NO se lee), reduce a ~120K, continúa compilación. Datos preservados, recuperables"
    motivo: "Incluso con rotación, proyectos muy grandes pueden acumular demasiados datos. Si full/ >150K tokens, CA no puede procesar eficientemente"
    impacto: "Ahorro real de tokens (history/ NO se lee). Datos preservados, no perdidos. Sistema escala ilimitadamente. Reversible"

  - id: "004"
    titulo: "YAML para todo (incluyendo sessions)"
    decision: "Todo el sistema usa YAML: sessions.yaml, adr.yaml, project-status.yaml, context.yaml, templates"
    motivo: "Sessions originalmente .md. Inconsistencia dificultaba parsing. YAML: ~30% ahorro tokens vs Markdown, mejor para LLMs"
    impacto: "Consistencia total del sistema. Ahorro significativo de tokens. Estructura clara para LLMs. Fácil parsear con js-yaml"

  - id: "006"
    titulo: "Sistema de rutas unificado memsys3/"
    decision: "TODAS las rutas en memsys3_templates/ usan prefijo memsys3/: memory/, agents/, prompts/, etc. Durante deployment, templates se copia a raíz como memsys3/"
    motivo: "Confusión sobre rutas relativas. No estaba claro si eran del template o deployment. Inconsistencias memory/ vs @memory/"
    impacto: "Claridad total. Portabilidad entre proyectos. Sin conflictos con carpetas del proyecto. Actualizable fácilmente"

  - id: "007"
    titulo: "Separación de meta-niveles en READMEs"
    decision: "4 READMEs separados: 1) raíz (repositorio público, audiencia GitHub), 2) templates/ (sistema desplegado, agents/devs), 3) DEVELOPMENT.md (contribuidores), 4) UPDATE.md (actualización)"
    motivo: "README original mezclaba meta-niveles: qué es memsys3, instrucciones de uso, templates, dog-fooding. Confusión sobre nivel de cada información"
    impacto: "Claridad total de audiencias. Cada README específico. Agents leen README agnóstico sin confusión. Developers tienen guía clara"

  - id: "008"
    titulo: "Main-Agent NO debe proponer compile-context"
    decision: "Main-Agent tiene restricción explícita: NO proponer @memsys3/prompts/compile-context.md. Solo sugerir endSession. User decide cuándo compilar en nueva instancia limpia"
    motivo: "Main-Agent acumula tokens durante sesión. compile-context lee TODOS los archivos de full/ (>50K tokens). Acumular ambos es ineficiente y puede superar límites"
    impacto: "Eficiencia de tokens optimizada. Main-Agent enfocado en desarrollo. Context Agent trabaja con instancia limpia. User controla cuándo compilar"

  - id: "009"
    titulo: "Templates como documentación activa permanente + gotchas en sessions"
    decision: "1) memory/templates/ son guías permanentes (NO se borran post-deployment). Main-Agent consulta durante endSession. 2) Gotchas documentados en sessions.yaml con estructura: tipo, problema, solución, criticidad. CA extrae top 5 más críticos de TODAS las sessions"
    motivo: "Templates contienen: estructura, instrucciones, ejemplos de buenas prácticas. Main-Agent necesita consultarlos. Gotchas surgen DURANTE sesiones, deben estar contextualizados (no en project-status estático)"
    impacto: "Deployment simple (copiar todo). Main-Agent siempre tiene referencia. Gotchas contextualizados. CA flexible para priorizar. project-status más limpio"

# ============================================
# SESIONES RECIENTES (Highlights)
# ============================================
sesiones_recientes:
  - id: "2025-11-12-feature-002"
    data: "2025-11-12"
    titulo: "FEATURE-002: actualizar.md + README opcional"
    que_se_hizo:
      - "Prompt actualizar.md creado (551 líneas) para actualización segura de memsys3"
      - "PASO 0 crítico: Detección estructura antigua incompatible (3 escenarios: A) solo /memory, B) /memory + /memsys3 coexistiendo, C) solo /memsys3)"
      - "Testing real en deCastro_inmobiliaria: v1.0 → v0.5.0 con migración de datos (134+320+222 líneas)"
      - "README.md ahora opcional en Context Agent con condicional inteligente"
      - "compile-context.md pregunta si crear README desde project-status.yaml"
    problemas_resueltos:
      - "actualizar.md no contemplaba estructura antigua pre-ADR-006. PASO 0 agregado detecta coexistencia /memory (datos reales) + /memsys3 (datos template)"
      - "deCastro tenía DOS estructuras sin migración. Migración manual preservó histórico"
      - "README obligatorio rompería proyectos existentes sin README. Movido a opcional con condicional"
    decisiones:
      - "actualizar.md debe ser defensivo: detectar edge-cases ANTES de proceder"
      - "README opcional con pregunta al usuario (crear automáticamente desde project-status o continuar sin él)"
      - "Prioridad FEATURE-002 escalada Media → Alta (testing descubrió escenario crítico integridad datos)"
    gotchas_documentados:
      - "Estructura pre-ADR-006 puede coexistir sin migrar datos. Detectar con: ls -la memory/ && ls -la memsys3/ → verificar cuál tiene datos reales"
      - "project-status.yaml puede tener datos template memsys3 en lugar del proyecto real. Verificar que 'que_es' describe el PROYECTO"
      - "Proyectos sin README.md fallarían con README obligatorio. README movido a opcional + pregunta crear automáticamente"

  - id: "2025-11-12-deployment-soluzzia"
    data: "2025-11-12"
    titulo: "Deployment Soluzzia + README en Context + Tracking Versiones"
    que_se_hizo:
      - "Deployment completo memsys3 v0.4.0+20 en proyecto Soluzzia (primer proyecto real)"
      - "Context Agent lee README.md (input obligatorio → ahora opcional, máx 300 líneas)"
      - "Sistema tracking versión: memsys3_version y memsys3_deployed en project-status.yaml"
      - "Verificación post-compilación: CA pregunta si README está actualizado"
      - "FEATURE-002 creado en backlog: prompt actualizar.md"
    decisiones:
      - "Versión memsys3 SOLO en project-status (no duplicar en context). Un lugar = más fácil mantener"
      - "README como input obligatorio (resuelve IMPROVEMENT-001 parcialmente). Nuevas instancias tienen contexto proyecto sin leerlo manualmente"
      - "Verificación activa README post-compilación. CA pregunta, compara con project-status, propone updates"

  - id: "2025-11-03-verificacion"
    data: "2025-11-03"
    titulo: "Verificación FASE 3 + Problema Escalabilidad"
    highlights_sintetizados:
      - "Auditoría FASE 3: 200+ líneas catalán residual detectadas (otra instancia reportó '0')"
      - "Sistema backlog creado con 6 prefijos (ISSUE, FEATURE, SPEC, etc.)"
      - "ISSUE-001 escalabilidad: sin verificación automatizada, sincronización manual propensa errores"
      - "IMPROVEMENT-001: Contexto con docs críticos (README, DEVELOPMENT, UPDATE)"

# ============================================
# GOTCHAS CRÍTICOS
# ============================================
gotchas:
  - id: "estructura-pre-adr006"
    problema: "Estructura pre-ADR-006 puede coexistir con estructura nueva sin migrar datos"
    solucion: "Detectar con: ls -la memory/ && ls -la memsys3/ → si ambos existen, verificar cuál tiene datos reales. Caso deCastro: /memory datos reales + /memsys3 datos template. Context Agent leería incorrectos"
    criticidad: "alta"

  - id: "project-status-template"
    problema: "project-status.yaml puede tener datos del template memsys3 en lugar del proyecto real"
    solucion: "Verificar que campos 'que_es' describen el PROYECTO, no 'Sistema de gestió de context'. Deployment inicial incorrecto puede copiar template sin personalizar"
    criticidad: "alta"

  - id: "deploy-sobrescritura"
    problema: "deploy.md sin verificaciones puede sobrescribir datos al ejecutarse dos veces"
    solucion: "Verificar si memsys3/ existe antes de mkdir. Limpiar memsys3_temp/ si existe de ejecución previa. Previene pérdida datos irrecuperable"
    criticidad: "alta"

  - id: "viewer-nomenclatura"
    problema: "viewer.js buscaba adrs_filtrades pero YAML usa adrs_incloses"
    solucion: "Estandarizar nomenclatura en ambos archivos. adrs_incloses elegido por ser más claro. Estadística 'ADRs Filtradas' ahora funciona"
    criticidad: "media"

  - id: "history-gitkeep"
    problema: "history/ vacío no se sube a git bloqueando Plan Contingencia en otros clones"
    solucion: "Crear .gitkeep en directorios vacíos que deben existir en git. deploy.md crea .gitkeep durante deployment"
    criticidad: "media"

# ============================================
# PENDIENTES PRIORITARIOS
# ============================================
pendientes:
  - prioritat: 1
    tasca: "Testear actualizar.md en proyecto con estructura correcta (Escenario C)"
    detall: "Validar actualización en proyecto que solo tenga /memsys3 (no estructura antigua). Probar en Soluzzia"

  - prioritat: 2
    tasca: "Validar compile-context.md con creación automática de README"
    detall: "Ejecutar en deCastro (sin README), probar Opción A (crear automáticamente desde project-status.yaml)"

  - prioritat: 3
    tasca: "IMPROVEMENT-001 parcialmente resuelto - Evaluar siguiente fase"
    detall: "README ya incluido en contexto (opcional). Evaluar si agregar DEVELOPMENT.md, UPDATE.md según necesidad"

  - prioritat: 3
    tasca: "Considerar ISSUE-001 Fase 1 (documentar puntos calientes)"
    detall: "Quick win: agregar checklist en DEVELOPMENT.md de qué sincronizar en cada tipo de cambio"

  - prioritat: 4
    tasca: "Migrar repos: memsys3_dev (privado) vs memsys3 (público)"
    detall: "Separar desarrollo interno de distribución pública según decisión ADR-009"

# ============================================
# DECISIONES CLAVE DEL PROYECTO
# ============================================
decisions_clau:
  filosofia: "Criterio inteligente del CA, NO límites arbitrarios"
  escalabilidad: "Rotación + archivado automático"
  preservacio: "Datos SIEMPRE preservados (history/, sessions_N.yaml, adr_N.yaml)"
  rutas: "Sistema unificado memsys3/ para portabilidad y claridad"
  documentacion: "Meta-niveles separados según audiencia"
  workflow: "Main-Agent NO compila, solo sugiere endSession"
  templates: "memory/templates/ son guías permanentes, NO se borran post-deployment"
  gotchas: "Se documentan en sessions.yaml (contextualizados), NO en project-status"
  deployment: "Clone temporal memsys3_temp, copiar, briefing con templates, borrar temp"
  backlog: "docs/backlog/ organiza trabajo futuro con 6 prefijos, NO se distribuye (específico dev memsys3)"
  readme_opcional: "Context Agent acepta proyectos sin README (con warning) o puede crear automáticamente"

# ============================================
# NOTAS DE COMPILACIÓN DEL CA
# ============================================
notas_compilacion:
  adrs_totales: 9
  adrs_incluidas: 9
  justificacion_adrs: "Todas las ADRs son fundamentales para entender arquitectura del sistema. Impacto global en: criterio compilación (001), escalabilidad (002-003), formato (004), rutas (006), documentación (007), workflow (008), filosofía templates (009)"

  sesiones_totales: 13
  sesiones_incluidas: 3
  justificacion_sesiones: "Seleccionadas 3 más recientes y significativas: FEATURE-002 (actualizar.md crítico + README opcional), Deployment Soluzzia (primer proyecto real + tracking versiones), Verificación escalabilidad (ISSUE-001 + sistema backlog). Resto sintetizado en historic_sessions de project-status"

  gotchas_extraidos: 5
  gotchas_totales_en_sessions: 8
  justificacion_gotchas: "Seleccionados 5 más críticos por impacto: estructura pre-ADR006 (alta, integridad datos), project-status-template (alta, deployment incorrecto), deploy-sobrescritura (alta, pérdida datos), viewer-nomenclatura (media, funcionalidad), history-gitkeep (media, Plan Contingencia)"

  readme_sintetizado: true
  readme_lineas_originales: 237
  readme_lineas_sintetizadas: 95
  justificacion_readme: "README actualizado con versión 1.5 y features recientes (actualizar.md, README opcional). Mantenida esencia: problema, solución, quick start, estructura, workflow, features. Omitidos: badges, licencia, contribuciones, detalles menores"

  tokens_estimados_iniciales: "~9,400 tokens (README 1K + adr 2.2K + sessions 5.5K + project-status 0.7K)"
  tokens_estimados_finales: "~3,500 tokens"
  ahorro_tokens: "~62% reducción manteniendo información crítica"

  archivamiento_activado: false
  motivo_no_archivar: "Tokens iniciales muy por debajo de 150K. No requiere Plan Contingencia"

  criterios_filtraje: |
    - Impacto global (ADRs afectan TODO el sistema)
    - Relevancia actual (sesiones recientes, gotchas activos)
    - Información no obvia (decisiones arquitectónicas, gotchas críticos)
    - Contexto histórico crítico (por qué hacemos esto así)
    - Omitidos: detalles cosméticos, ADRs deprecated, sesiones muy antiguas sin impacto

  lineas_totales: 427
  limite_maximo: 2000
  margen_disponible: 1573
  observaciones: |
    Compilación exitosa sin requerir Plan Contingencia.
    Sistema memsys3 tiene documentación muy bien estructurada y limpia.
    Todas las ADRs son relevantes (ninguna deprecated).
    Sessions recientes muy significativas (FEATURE-002, deployment real, escalabilidad).
    README bien documentado, fácil de sintetizar manteniendo esencia.

    Highlights compilación v1.6.1:
    - README actualizado con versión 1.5 y features recientes (actualizar.md, README opcional)
    - UPDATE.md actualizado con método recomendado: @memsys3/prompts/actualizar.md
    - README opcional implementado correctamente en compile-context.md
    - actualizar.md es crítico para proyectos existentes (PASO 0 detecta estructura antigua)
    - Sistema de backlog bien organizado
    - Problema escalabilidad identificado (ISSUE-001) - no urgente pero importante medio plazo
    - FEATURE-002 testing real en deCastro validó robustez del sistema

    Post-compilación:
    - Verificación README completada
    - README sincronizado con project-status (versión, features, estado actual)
    - docs/UPDATE.md actualizado con prompt actualizar.md como método recomendado

# ============================================
# NOTAS DE USO
# ============================================
# Este archivo es COMPILADO automáticamente, no editar manualmente
# Para actualizar: ejecutar @memsys3/prompts/compile-context.md
# Para más detalles: ver memsys3/memory/full/adr.yaml y memsys3/memory/full/sessions.yaml
# Si contexto demasiado grande: CA moverá datos a memsys3/memory/history/ (no leído)
